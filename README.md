# crawl_data

## SBV HTML Data Extraction Tool

This repository contains a Python script to extract structured data from SBV (State Bank of Vietnam) HTML reports and convert them to CSV format with UTF-8 encoding for Oracle database import.

### Features

- **UTF-8 Encoding**: All output CSV files are saved in UTF-8 encoding, ensuring compatibility with Oracle databases and proper handling of Vietnamese characters
- **Multiple HTML File Support**: Supports both quarterly and annual SBV reports:
  - `sbv_data_IV_2024_v1_20250904.html` (Q4 2024 data)
  - `sbv_data_I_2025_v1_20250904.html` (Q1 2025 data)
- **Hierarchical Data Extraction**: Extracts data with up to 6 levels of hierarchy (DATA_GROUP_L1 to DATA_GROUP_L6)
- **Automatic Padding Detection**: Uses CSS padding-left values to determine data hierarchy levels
- **Value Cleaning**: Removes thousands separators and decimal points from numeric values

### Usage

#### Basic Usage
```bash
# Process the default file (IV/2024)
python3 extract_sbv_html.py

# Process a specific HTML file
python3 extract_sbv_html.py sbv_data_I_2025_v1_20250904.html
```

#### Requirements
```bash
pip install beautifulsoup4 pandas
```

### Output Files

The script generates the following files:
- **Primary output**: `sbv_data_[PERIOD]_v1_20250904.csv` - Main extracted data in UTF-8 encoding
- **Result matching**: `result_new.csv` - Data matched against sample format (if result.csv exists)

### Output Format

Each CSV file contains the following columns:
- `DATA_GROUP_L1`: Top-level category (e.g., "Cán cân vãng lai")
- `DATA_GROUP_L2`: Second-level category (e.g., "Hàng hóa: Xuất khẩu f.o.b")
- `DATA_GROUP_L3`: Third-level category
- `DATA_GROUP_L4`: Fourth-level category
- `DATA_GROUP_L5`: Fifth-level category
- `DATA_GROUP_L6`: Sixth-level category
- `VALUE`: Numeric value (cleaned, no thousands separators)

### Example Output
```csv
DATA_GROUP_L1,DATA_GROUP_L2,DATA_GROUP_L3,DATA_GROUP_L4,DATA_GROUP_L5,DATA_GROUP_L6,VALUE
Cán cân vãng lai,,,,,,3959
Cán cân vãng lai,Hàng hóa: Xuất khẩu f.o.b,,,,,102836
Cán cân vãng lai,Hàng hóa: Nhập khẩu f.o.b,,,,,94897
```

### Oracle Database Compatibility

The output CSV files are specifically formatted for Oracle database import:
- **UTF-8 encoding** ensures proper handling of Vietnamese characters
- **Cleaned numeric values** (no commas or periods as thousands separators)
- **Consistent column structure** across all output files
- **NULL handling** for empty hierarchy levels

### Data Hierarchy Logic

The extraction logic uses the following rules:
1. **Padding-based levels**:
   - 20px padding → DATA_GROUP_L2
   - 57px padding → DATA_GROUP_L3  
   - 90px padding → DATA_GROUP_L4
   - 125px padding → DATA_GROUP_L5
   - 160px padding → DATA_GROUP_L6

2. **Font style detection**:
   - Italic text typically indicates summary/calculated values
   - Bold text indicates major category totals

3. **Value inheritance**:
   - DATA_GROUP_L1 values are inherited down the hierarchy
   - Lower levels are reset when a higher level changes

### Files in Repository

- `extract_sbv_html.py` - Main extraction script
- `sbv_data_IV_2024_v1_20250904.html` - Q4 2024 SBV data
- `sbv_data_I_2025_v1_20250904.html` - Q1 2025 SBV data  
- `result.csv` - Sample output format (if available)
- Various output CSV files generated by the script